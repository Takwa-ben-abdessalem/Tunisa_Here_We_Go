import { ReplaySubject } from 'rxjs';
export class OStore {
    constructor(start) {
        /**
         * Map of Key Value pair entries
         * containing values store in this store.
         */
        this.entries = new Map();
        /**
         * Map of replay subject id to `ReplaySubject` instance.
         */
        this.subjects = new Map();
        if (start) {
            this.S = start;
            const keys = Object.keys(start);
            keys.forEach((k) => {
                const ovr = start[k];
                this.post(ovr, ovr.value);
                ovr.obs = this.observe(ovr);
            });
        }
    }
    /**
     * Reset the state of the OStore to the
     * values or reset provided in the constructor
     * {@link OStoreStart} instance.
     */
    reset() {
        if (this.S) {
            const keys = Object.keys(this.S);
            keys.forEach((k) => {
                const ovr = this.S[k];
                this.put(ovr, ovr.reset ? ovr.reset : ovr.value);
            });
        }
    }
    /**
     * Clear all entries
     */
    clear() {
        this.entries.clear();
    }
    /**
     * Set create a key value pair entry and creates a
     * corresponding replay subject instance that will
     * be used to broadcast updates.
     *
     * @param key The key identifying the value
     * @param value The value
     */
    post(key, value) {
        this.entries.set(key, value);
        this.subjects.set(key, new ReplaySubject(1));
        //Emit immediately so that Observers can receive 
        //the value straight away.
        const subject = this.subjects.get(key);
        if (subject) {
            subject.next(value);
        }
    }
    /**
     * Update a value and notify subscribers.
     *
     * @param key
     * @param value
     */
    put(key, value) {
        this.entries.set(key, value);
        const subject = this.subjects.get(key);
        if (subject) {
            subject.next(value);
        }
    }
    /**
     * Deletes both the value entry and the corresponding {@link ReplaySubject}.
     * Will unsubscribe the {@link ReplaySubject} prior to deleting it,
     * severing communication with corresponding {@link Observable}s.
     *
     * @param key
     */
    delete(key) {
        this.entries.delete(key);
        this.subjects.delete(key);
        const subject = this.subjects.get(key);
        if (subject) {
            subject.unsubscribe();
        }
    }
    /**
     * Observe changes to the values.
     *
     * @param key
     * @return An {@link Observable} of the value
     */
    observe(key) {
        return this.subjects.get(key).asObservable();
    }
    /**
      * Check whether a value exists.
      *
      * @param key
      * @return True if the entry exists ( Is not null or undefined ) and false otherwise.
      */
    exists(key) {
        return this.entries.get(key) != null;
    }
    /**
     * Retrieve a snapshot of the
     * value.
     *
     * @param key
     * @return A snapshot of the value corresponding to the key.
     */
    snapshot(key) {
        return this.entries.get(key);
    }
    /**
     * Indicates whether the store is empty.
     * @return true if the store is empty, false otherwise.
     */
    isEmpty() {
        return Array.from(this.entries.values()).length == 0;
    }
    /**
     * Returns the number of key value pairs contained.
     *
     * @return the number of entries in the store.
     */
    count() {
        return Array.from(this.entries.values()).length;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1N0b3JlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvc2xpY2Uvc3JjL2xpYi9PU3RvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGFBQWEsRUFBYyxNQUFNLE1BQU0sQ0FBQTtBQTJCaEQsTUFBTSxPQUFPLE1BQU07SUFPZixZQUFZLEtBQWtCO1FBbUM5Qjs7O1dBR0c7UUFDSSxZQUFPLEdBQWtCLElBQUksR0FBRyxFQUFFLENBQUE7UUFFekM7O1dBRUc7UUFDSyxhQUFRLEdBQWlDLElBQUksR0FBRyxFQUFFLENBQUE7UUEzQ3RELElBQUksS0FBSyxFQUFFO1lBQ1AsSUFBSSxDQUFDLENBQUMsR0FBTSxLQUFLLENBQUM7WUFDbEIsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUMvQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2YsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBa0IsQ0FBQTtnQkFDckMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO2dCQUN6QixHQUFHLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDL0IsQ0FBQyxDQUFDLENBQUE7U0FDTDtJQUNMLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksS0FBSztRQUNSLElBQUksSUFBSSxDQUFDLENBQUMsRUFBRTtZQUNSLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQ2hDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQkFDZixNQUFNLEdBQUcsR0FBa0IsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDcEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQ3BELENBQUMsQ0FBQyxDQUFBO1NBQ0w7SUFDTCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxLQUFLO1FBQ1IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUN4QixDQUFDO0lBY0Q7Ozs7Ozs7T0FPRztJQUNJLElBQUksQ0FBQyxHQUFRLEVBQUUsS0FBVTtRQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDNUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLElBQUksYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDNUMsaURBQWlEO1FBQ2pELDBCQUEwQjtRQUMxQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN0QyxJQUFJLE9BQU8sRUFBRTtZQUNULE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDdEI7SUFDTCxDQUFDO0lBQ0Q7Ozs7O09BS0c7SUFDSSxHQUFHLENBQUMsR0FBUSxFQUFFLEtBQVU7UUFDM0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQzVCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ3RDLElBQUksT0FBTyxFQUFFO1lBQ1QsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtTQUN0QjtJQUNMLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSSxNQUFNLENBQUMsR0FBUTtRQUNsQixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN4QixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN6QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN0QyxJQUFJLE9BQU8sRUFBRTtZQUNULE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQTtTQUN4QjtJQUNMLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLE9BQU8sQ0FBQyxHQUFRO1FBQ25CLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFFLENBQUMsWUFBWSxFQUFFLENBQUE7SUFDakQsQ0FBQztJQUVEOzs7OztRQUtJO0lBQ0csTUFBTSxDQUFDLEdBQVE7UUFDbEIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUE7SUFDeEMsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNJLFFBQVEsQ0FBQyxHQUFRO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDaEMsQ0FBQztJQUVEOzs7T0FHRztJQUNJLE9BQU87UUFDVixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUE7SUFDeEQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxLQUFLO1FBQ1IsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUE7SUFDbkQsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVwbGF5U3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnXG5cbi8qKlxuICogSW5pdGlhbGl6ZSBodGUgc3RvcmUgd2l0aCB0aGlzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFZhbHVlUmVzZXQge1xuICAgIHZhbHVlOiBhbnlcbiAgICByZXNldD86IGFueVxufVxuXG4vKipcbiAqIE9TdG9yZSBLZXkgVmFsdWUgUmVzZXRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBPYnNWYWx1ZVJlc2V0IHtcbiAgICB2YWx1ZTogYW55XG4gICAgcmVzZXQ/OiBhbnlcbiAgICBvYnM6IE9ic2VydmFibGU8YW55PlxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEtleU9ic1ZhbHVlUmVzZXQge1xuICAgIFtrZXk6IHN0cmluZ106IE9ic1ZhbHVlUmVzZXRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPU3RvcmVTdGFydCB7XG4gICAgW2tleTogc3RyaW5nXTogVmFsdWVSZXNldFxufVxuXG5leHBvcnQgY2xhc3MgT1N0b3JlPEUgZXh0ZW5kcyBLZXlPYnNWYWx1ZVJlc2V0PiB7XG4gICAgLyoqXG4gICAgICogU3RhcnQga2V5cyBhbmQgdmFsdWVzXG4gICAgICogcGFzc2VkIGluIHZpYSBjb25zdHJ1Y3Rvci5cbiAgICAgKi9cbiAgICBwdWJsaWMgUyE6IEVcblxuICAgIGNvbnN0cnVjdG9yKHN0YXJ0OiBPU3RvcmVTdGFydCkge1xuICAgICAgICBpZiAoc3RhcnQpIHtcbiAgICAgICAgICAgIHRoaXMuUyA9IDxFPnN0YXJ0O1xuICAgICAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHN0YXJ0KVxuICAgICAgICAgICAga2V5cy5mb3JFYWNoKChrKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3ZyID0gc3RhcnRba10gYXMgT2JzVmFsdWVSZXNldFxuICAgICAgICAgICAgICAgIHRoaXMucG9zdChvdnIsIG92ci52YWx1ZSlcbiAgICAgICAgICAgICAgICBvdnIub2JzID0gdGhpcy5vYnNlcnZlKG92cilcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNldCB0aGUgc3RhdGUgb2YgdGhlIE9TdG9yZSB0byB0aGVcbiAgICAgKiB2YWx1ZXMgb3IgcmVzZXQgcHJvdmlkZWQgaW4gdGhlIGNvbnN0cnVjdG9yXG4gICAgICoge0BsaW5rIE9TdG9yZVN0YXJ0fSBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgcmVzZXQoKSB7XG4gICAgICAgIGlmICh0aGlzLlMpIHtcbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLlMpXG4gICAgICAgICAgICBrZXlzLmZvckVhY2goKGspID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBvdnI6IE9ic1ZhbHVlUmVzZXQgPSB0aGlzLlNba11cbiAgICAgICAgICAgICAgICB0aGlzLnB1dChvdnIsIG92ci5yZXNldCA/IG92ci5yZXNldCA6IG92ci52YWx1ZSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhciBhbGwgZW50cmllc1xuICAgICAqL1xuICAgIHB1YmxpYyBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5lbnRyaWVzLmNsZWFyKClcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIE1hcCBvZiBLZXkgVmFsdWUgcGFpciBlbnRyaWVzXG4gICAgICogY29udGFpbmluZyB2YWx1ZXMgc3RvcmUgaW4gdGhpcyBzdG9yZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgZW50cmllczogTWFwPGFueSwgYW55PiA9IG5ldyBNYXAoKVxuXG4gICAgLyoqXG4gICAgICogTWFwIG9mIHJlcGxheSBzdWJqZWN0IGlkIHRvIGBSZXBsYXlTdWJqZWN0YCBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBwcml2YXRlIHN1YmplY3RzOiBNYXA8YW55LCBSZXBsYXlTdWJqZWN0PGFueT4+ID0gbmV3IE1hcCgpXG5cbiAgICAvKipcbiAgICAgKiBTZXQgY3JlYXRlIGEga2V5IHZhbHVlIHBhaXIgZW50cnkgYW5kIGNyZWF0ZXMgYSBcbiAgICAgKiBjb3JyZXNwb25kaW5nIHJlcGxheSBzdWJqZWN0IGluc3RhbmNlIHRoYXQgd2lsbFxuICAgICAqIGJlIHVzZWQgdG8gYnJvYWRjYXN0IHVwZGF0ZXMuXG4gICAgICogXG4gICAgICogQHBhcmFtIGtleSBUaGUga2V5IGlkZW50aWZ5aW5nIHRoZSB2YWx1ZVxuICAgICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWVcbiAgICAgKi9cbiAgICBwdWJsaWMgcG9zdChrZXk6IGFueSwgdmFsdWU6IGFueSkge1xuICAgICAgICB0aGlzLmVudHJpZXMuc2V0KGtleSwgdmFsdWUpXG4gICAgICAgIHRoaXMuc3ViamVjdHMuc2V0KGtleSwgbmV3IFJlcGxheVN1YmplY3QoMSkpXG4gICAgICAgIC8vRW1pdCBpbW1lZGlhdGVseSBzbyB0aGF0IE9ic2VydmVycyBjYW4gcmVjZWl2ZSBcbiAgICAgICAgLy90aGUgdmFsdWUgc3RyYWlnaHQgYXdheS5cbiAgICAgICAgY29uc3Qgc3ViamVjdCA9IHRoaXMuc3ViamVjdHMuZ2V0KGtleSlcbiAgICAgICAgaWYgKHN1YmplY3QpIHtcbiAgICAgICAgICAgIHN1YmplY3QubmV4dCh2YWx1ZSlcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgYSB2YWx1ZSBhbmQgbm90aWZ5IHN1YnNjcmliZXJzLlxuICAgICAqIFxuICAgICAqIEBwYXJhbSBrZXkgXG4gICAgICogQHBhcmFtIHZhbHVlIFxuICAgICAqL1xuICAgIHB1YmxpYyBwdXQoa2V5OiBhbnksIHZhbHVlOiBhbnkpIHtcbiAgICAgICAgdGhpcy5lbnRyaWVzLnNldChrZXksIHZhbHVlKVxuICAgICAgICBjb25zdCBzdWJqZWN0ID0gdGhpcy5zdWJqZWN0cy5nZXQoa2V5KVxuICAgICAgICBpZiAoc3ViamVjdCkge1xuICAgICAgICAgICAgc3ViamVjdC5uZXh0KHZhbHVlKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlcyBib3RoIHRoZSB2YWx1ZSBlbnRyeSBhbmQgdGhlIGNvcnJlc3BvbmRpbmcge0BsaW5rIFJlcGxheVN1YmplY3R9LlxuICAgICAqIFdpbGwgdW5zdWJzY3JpYmUgdGhlIHtAbGluayBSZXBsYXlTdWJqZWN0fSBwcmlvciB0byBkZWxldGluZyBpdCxcbiAgICAgKiBzZXZlcmluZyBjb21tdW5pY2F0aW9uIHdpdGggY29ycmVzcG9uZGluZyB7QGxpbmsgT2JzZXJ2YWJsZX1zLlxuICAgICAqICBcbiAgICAgKiBAcGFyYW0ga2V5IFxuICAgICAqL1xuICAgIHB1YmxpYyBkZWxldGUoa2V5OiBhbnkpIHtcbiAgICAgICAgdGhpcy5lbnRyaWVzLmRlbGV0ZShrZXkpXG4gICAgICAgIHRoaXMuc3ViamVjdHMuZGVsZXRlKGtleSlcbiAgICAgICAgY29uc3Qgc3ViamVjdCA9IHRoaXMuc3ViamVjdHMuZ2V0KGtleSlcbiAgICAgICAgaWYgKHN1YmplY3QpIHtcbiAgICAgICAgICAgIHN1YmplY3QudW5zdWJzY3JpYmUoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT2JzZXJ2ZSBjaGFuZ2VzIHRvIHRoZSB2YWx1ZXMuXG4gICAgICogXG4gICAgICogQHBhcmFtIGtleSBcbiAgICAgKiBAcmV0dXJuIEFuIHtAbGluayBPYnNlcnZhYmxlfSBvZiB0aGUgdmFsdWVcbiAgICAgKi9cbiAgICBwdWJsaWMgb2JzZXJ2ZShrZXk6IGFueSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdWJqZWN0cy5nZXQoa2V5KSEuYXNPYnNlcnZhYmxlKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgICogQ2hlY2sgd2hldGhlciBhIHZhbHVlIGV4aXN0cy5cbiAgICAgICogXG4gICAgICAqIEBwYXJhbSBrZXkgXG4gICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZW50cnkgZXhpc3RzICggSXMgbm90IG51bGwgb3IgdW5kZWZpbmVkICkgYW5kIGZhbHNlIG90aGVyd2lzZS5cbiAgICAgICovXG4gICAgcHVibGljIGV4aXN0cyhrZXk6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5lbnRyaWVzLmdldChrZXkpICE9IG51bGxcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBhIHNuYXBzaG90IG9mIHRoZSBcbiAgICAgKiB2YWx1ZS5cbiAgICAgKiAgXG4gICAgICogQHBhcmFtIGtleSBcbiAgICAgKiBAcmV0dXJuIEEgc25hcHNob3Qgb2YgdGhlIHZhbHVlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGtleS5cbiAgICAgKi9cbiAgICBwdWJsaWMgc25hcHNob3Qoa2V5OiBhbnkpOiBhbnkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbnRyaWVzLmdldChrZXkpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHN0b3JlIGlzIGVtcHR5LlxuICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgc3RvcmUgaXMgZW1wdHksIGZhbHNlIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5lbnRyaWVzLnZhbHVlcygpKS5sZW5ndGggPT0gMFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBrZXkgdmFsdWUgcGFpcnMgY29udGFpbmVkLlxuICAgICAqIFxuICAgICAqIEByZXR1cm4gdGhlIG51bWJlciBvZiBlbnRyaWVzIGluIHRoZSBzdG9yZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgY291bnQoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZW50cmllcy52YWx1ZXMoKSkubGVuZ3RoXG4gICAgfVxufSJdfQ==